<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writer's Block</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.text-neon-blue { color: #0ff; }
.bg-neon-blue { background-color: #0ff; }
input::placeholder, textarea::placeholder { color: #0ff; opacity: 0.7; }
.text-neon-3d {
  color: #0ff;
  font-weight: 900;
  text-shadow: 2px 2px 0 #08b, 4px 4px 0 #055, 6px 6px 0 #022;
}
</style>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center p-6">

<h1 class="text-6xl font-extrabold mb-10 text-neon-3d">Writer's Block</h1>

<!-- Input Section -->
<div class="flex flex-col md:flex-row gap-4 mb-8 w-full max-w-3xl">
  <input id="inputLine" type="text" placeholder="Enter a word or line..."
    class="flex-1 p-3 rounded border-2 border-neon-blue bg-gray-800 text-neon-blue placeholder-neon-blue focus:outline-none focus:ring-2 focus:ring-neon-blue text-lg"/>
  <button id="generateBtn" class="bg-neon-blue text-black px-6 py-3 rounded hover:brightness-125 transition text-lg">Generate</button>
  <button id="undoBtn" class="bg-gray-700 text-neon-blue px-6 py-3 rounded hover:brightness-125 transition text-lg ml-2">Undo</button>
</div>

<!-- Beat Upload -->
<div class="flex flex-col items-center mb-8 w-full max-w-3xl">
  <input type="file" id="beatUpload"
         class="w-full p-4 rounded border-2 border-neon-blue text-neon-blue cursor-pointer text-lg"
         accept="audio/*"/>
  <audio id="beatPlayer" controls class="mt-2 w-full max-w-xl h-12 rounded border-2 border-neon-blue p-1 hidden"></audio>
</div>

<!-- Editable Lyrics Workspace -->
<h2 class="text-2xl font-bold text-neon-blue mb-3">Lyrics</h2>
<textarea id="lyricsArea"
  class="w-full max-w-3xl h-64 p-4 rounded border-2 border-neon-blue bg-gray-800 text-neon-blue focus:outline-none focus:ring-2 focus:ring-neon-blue text-lg resize-y"
  placeholder="Your lyrics go here..."></textarea>

<!-- Save Lyrics -->
<button id="saveBtn" class="bg-neon-blue text-black px-8 py-3 rounded hover:brightness-125 transition text-lg mt-6">Save Lyrics</button>

<script>
const inputLine = document.getElementById('inputLine');
const generateBtn = document.getElementById('generateBtn');
const undoBtn = document.getElementById('undoBtn');
const lyricsArea = document.getElementById('lyricsArea');
const saveBtn = document.getElementById('saveBtn');
const beatUpload = document.getElementById('beatUpload');
const beatPlayer = document.getElementById('beatPlayer');

// Handle Beat Upload
beatUpload.addEventListener('change', () => {
  const file = beatUpload.files[0];
  if(file){
    beatPlayer.src = URL.createObjectURL(file);
    beatPlayer.classList.remove('hidden');
  }
});

// Generate a single rhyming word and append on next line
generateBtn.addEventListener('click', async () => {
  const line = inputLine.value.trim();
  if (!line) return;

  const words = line.split(' ');
  const lastWord = words[words.length - 1];

  try {
    const res = await fetch(`https://api.datamuse.com/words?rel_rhy=${lastWord}&max=20`);
    const data = await res.json();

    if(data.length === 0){
      lyricsArea.value += `\n(No rhymes found for '${lastWord}')`;
      return;
    }

    const rhyme = data[Math.floor(Math.random() * data.length)].word;
    lyricsArea.value += `\n${rhyme}`;

  } catch(err){
    console.error(err);
    lyricsArea.value += "\n(Error generating rhyme)";
  }
});

// Undo last line
undoBtn.addEventListener('click', () => {
  const lines = lyricsArea.value.split('\n');
  if(lines.length > 0){
    lines.pop();
    lyricsArea.value = lines.join('\n');
  }
});

// Save Lyrics
saveBtn.addEventListener('click', () => {
  const text = lyricsArea.value;
  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'lyrics.txt';
  a.click();
});
</script>

</body>
</html>
