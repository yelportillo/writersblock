<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writer's Block</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --neon-blue: #0ff;
  --neon-dark: #055;
}

.text-neon-blue { color: var(--neon-blue); }
.bg-neon-blue { background-color: var(--neon-blue); }
input::placeholder, textarea::placeholder { color: var(--neon-blue); opacity: 0.8; }

.text-neon-3d {
  color: var(--neon-blue);
  font-weight: 900;
  text-shadow: 2px 2px 0 #08b, 4px 4px 0 #055, 6px 6px 0 #022;
}

button {
  transition: all 0.2s ease-in-out;
}
button:hover {
  box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
}

textarea, select {
  transition: all 0.2s ease-in-out;
}

#beatDropArea.dragover {
  border-color: var(--neon-blue);
  background-color: #111;
}
</style>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center p-6">

<h1 class="text-6xl font-extrabold mb-10 text-neon-3d">Writer's Block</h1>

<!-- Input Section -->
<div class="flex flex-col md:flex-row gap-4 mb-2 w-full max-w-3xl">
  <input id="inputLine" type="text" placeholder="Enter a word or line..."
    class="flex-1 p-3 rounded border-2 border-neon-blue bg-gray-800 text-neon-blue placeholder-neon-blue focus:outline-none focus:ring-2 focus:ring-neon-blue text-lg"/>
  <button id="generateBtn" class="bg-neon-blue text-black px-6 py-3 rounded hover:brightness-125 transition text-lg">Generate</button>
  <button id="undoBtn" class="bg-gray-700 text-neon-blue px-6 py-3 rounded hover:brightness-125 transition text-lg ml-2">Undo</button>
</div>

<!-- Rhyme Options Dropdown -->
<select id="rhymeDropdown" class="w-full md:w-1/3 p-2 rounded border-2 border-neon-blue bg-gray-800 text-neon-blue text-lg hidden mb-4">
  <option value="">Select a rhyme</option>
</select>

<!-- Beat Upload Section -->
<div id="beatDropArea" class="flex flex-col items-center mb-4 w-full max-w-3xl p-4 border-2 border-neon-blue rounded bg-gray-800 text-neon-blue">
  <p class="mb-2 text-center">Drag & Drop a beat here or click "Choose Beat"</p>
  <button id="chooseBeatBtn" class="bg-neon-blue text-black px-6 py-3 rounded hover:brightness-125 transition">Choose Beat</button>
  <input type="file" id="beatUpload" class="hidden"/>
</div>

<!-- Beat Player Box -->
<div id="beatPlayerBox" class="flex flex-col items-center w-full max-w-3xl p-4 border-2 border-neon-blue rounded bg-gray-800 text-neon-blue hidden mb-8">
  <p class="mb-2">Now Playing:</p>
  <audio id="beatPlayer" controls class="w-full h-12 rounded"></audio>
</div>

<!-- Editable Lyrics Workspace -->
<h2 class="text-2xl font-bold text-neon-blue mb-3">Lyrics</h2>
<textarea id="lyricsArea"
  class="w-full max-w-3xl h-64 p-4 rounded border-2 border-neon-blue bg-gray-800 text-neon-blue focus:outline-none focus:ring-2 focus:ring-neon-blue text-lg resize-y"
  placeholder="Your lyrics go here..."></textarea>

<!-- Save Lyrics -->
<button id="saveBtn" class="bg-neon-blue text-black px-8 py-3 rounded hover:brightness-125 transition text-lg mt-6">Save Lyrics</button>

<script>
const inputLine = document.getElementById('inputLine');
const generateBtn = document.getElementById('generateBtn');
const undoBtn = document.getElementById('undoBtn');
const lyricsArea = document.getElementById('lyricsArea');
const saveBtn = document.getElementById('saveBtn');
const chooseBeatBtn = document.getElementById('chooseBeatBtn');
const beatUpload = document.getElementById('beatUpload');
const beatPlayer = document.getElementById('beatPlayer');
const beatDropArea = document.getElementById('beatDropArea');
const beatPlayerBox = document.getElementById('beatPlayerBox');
const rhymeDropdown = document.getElementById('rhymeDropdown');

// --- Beat Upload & Drag-and-Drop ---
chooseBeatBtn.addEventListener('click', () => beatUpload.click());
beatUpload.addEventListener('change', handleBeatFile);

beatDropArea.addEventListener('dragover', e => {
  e.preventDefault();
  beatDropArea.classList.add('dragover');
});
beatDropArea.addEventListener('dragleave', () => {
  beatDropArea.classList.remove('dragover');
});
beatDropArea.addEventListener('drop', e => {
  e.preventDefault();
  beatDropArea.classList.remove('dragover');
  if (e.dataTransfer.files.length) {
    beatUpload.files = e.dataTransfer.files;
    handleBeatFile();
  }
});

function handleBeatFile() {
  const file = beatUpload.files[0];
  if(!file) return;
  if(!file.type.startsWith('audio/')) {
    alert('Please select a valid audio file.');
    beatUpload.value = '';
    return;
  }
  beatPlayer.src = URL.createObjectURL(file);
  beatPlayerBox.classList.remove('hidden');
}

// --- Generate Rhyme with dropdown ---
async function generateRhyme() {
  const line = inputLine.value.trim();
  if (!line) return;

  const words = line.split(' ');
  const lastWord = words[words.length - 1];

  try {
    const res = await fetch(`https://api.datamuse.com/words?rel_rhy=${lastWord}&max=5`);
    const data = await res.json();

    if (data.length === 0){
      appendLyrics(`(No rhymes found for '${lastWord}')`);
      inputLine.value = '';
      rhymeDropdown.classList.add('hidden');
      return;
    }

    // Populate dropdown
    rhymeDropdown.innerHTML = '<option value="">Select a rhyme</option>';
    data.forEach(item => {
      const opt = document.createElement('option');
      opt.value = item.word;
      opt.textContent = item.word;
      rhymeDropdown.appendChild(opt);
    });
    rhymeDropdown.classList.remove('hidden');

    // Append first rhyme automatically
    appendLyrics(data[0].word);
    inputLine.value = '';

  } catch(err){
    console.error(err);
    appendLyrics("(Error generating rhyme)");
  }
}

// --- When dropdown selection changes ---
rhymeDropdown.addEventListener('change', () => {
  if (rhymeDropdown.value) {
    const lines = lyricsArea.value.split('\n');
    lines.pop(); // remove last line
    lines.push(rhymeDropdown.value); // add selected rhyme
    lyricsArea.value = lines.join('\n');
    rhymeDropdown.selectedIndex = 0; // reset dropdown
  }
});

// --- Append Lyrics with auto-scroll ---
function appendLyrics(text) {
  lyricsArea.value += lyricsArea.value ? `\n${text}` : text;
  lyricsArea.scrollTop = lyricsArea.scrollHeight;
}

// --- Event Listeners ---
generateBtn.addEventListener('click', generateRhyme);
inputLine.addEventListener('keypress', e => { if(e.key === 'Enter') generateRhyme(); });

undoBtn.addEventListener('click', () => {
  const lines = lyricsArea.value.split('\n');
  if(lines.length > 0){
    lines.pop();
    lyricsArea.value = lines.join('\n');
  }
});

// --- Save Lyrics ---
saveBtn.addEventListener('click', () => {
  const text = lyricsArea.value;
  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'lyrics.txt';
  a.click();
});
</script>

</body>
</html>
